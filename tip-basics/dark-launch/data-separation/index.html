<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tip-basics/dark-launch/data-separation">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Data Separation | prodtest</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://brdv.github.io//prodtest-docs/tip-basics/dark-launch/data-separation"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Data Separation | prodtest"><meta data-rh="true" name="description" content="As mentioned on the Dark Launch page there are different ways an application cal collect and store data. For this guide, we will stick to the ways that are used in the prodtest-demo project: a database and a message queue."><meta data-rh="true" property="og:description" content="As mentioned on the Dark Launch page there are different ways an application cal collect and store data. For this guide, we will stick to the ways that are used in the prodtest-demo project: a database and a message queue."><link data-rh="true" rel="icon" href="/prodtest-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://brdv.github.io//prodtest-docs/tip-basics/dark-launch/data-separation"><link data-rh="true" rel="alternate" href="https://brdv.github.io//prodtest-docs/tip-basics/dark-launch/data-separation" hreflang="en"><link data-rh="true" rel="alternate" href="https://brdv.github.io//prodtest-docs/tip-basics/dark-launch/data-separation" hreflang="x-default"><link rel="stylesheet" href="/prodtest-docs/assets/css/styles.70546f8b.css">
<link rel="preload" href="/prodtest-docs/assets/js/runtime~main.d6632b52.js" as="script">
<link rel="preload" href="/prodtest-docs/assets/js/main.d419b82a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/prodtest-docs/"><b class="navbar__title text--truncate">prodtest</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/brdv/prodtest-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prodtest-docs/">Prodtest</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/prodtest-docs/category/testing-in-production">Testing in production</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing in production&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/prodtest-docs/tip-basics/dark-launch/">Dark Launch</a><button aria-label="Toggle the collapsible sidebar category &#x27;Dark Launch&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/prodtest-docs/tip-basics/dark-launch/data-separation">Data Separation</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/prodtest-docs/category/demo-project">Demo Project</a><button aria-label="Toggle the collapsible sidebar category &#x27;Demo Project&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/prodtest-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/prodtest-docs/category/testing-in-production"><span itemprop="name">Testing in production</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/prodtest-docs/tip-basics/dark-launch/"><span itemprop="name">Dark Launch</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Data Separation</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Data Separation</h1></header><p>As mentioned on the <a href="/prodtest-docs/tip-basics/dark-launch/">Dark Launch page</a> there are different ways an application cal collect and store data. For this guide, we will stick to the ways that are used in the <a href="https://github.com/brdv/prodtest-demo" target="_blank" rel="noopener noreferrer">prodtest-demo</a> project: a database and a message queue.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="database">Database<a class="hash-link" href="#database" title="Direct link to heading">​</a></h2><p>When storing data in a database in your application, you want to make sure that the data generated by Vnext will not be shown to the user. Therefore, you need to find a way to separate that data from production data. There are various ways to accomplish such a thing. The following three are described in this guide: separate database, separate table and extending the data model.</p><p><strong>Note:</strong> If you want a quick overview of the options and the pros and cons, <a href="#overview">click here</a>!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="separate-database">Separate database<a class="hash-link" href="#separate-database" title="Direct link to heading">​</a></h3><p>One of the options is to use a separate database for Vnext. Vnext will setup a connection with the separate database and store all generated data in that database. This raises the question; what should you do if your application also needs data from the production database to function?</p><p>There are two basic options here; retrieving data directly from the production database or creating and managing a copy of the database. Both options are far from perfect. As retrieving data from a database twice (once for Vnext and once for Vlatest) will double the load on that database, meaning that you also have to double your resources. The second option might seem interesting at first, but think about the fact that you now will have to keep two database up to date all the time. Because if you do not keep your Vnext database up to date with Vlatest, you will most likely get errors on reads or writes because of data missing from the database.</p><p>This does not mean, however, that this option will never be a valid choice. It will always depend on your application.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="separate-table">Separate table<a class="hash-link" href="#separate-table" title="Direct link to heading">​</a></h3><p>Another option is to use a separate &#x27;shadow&#x27; table. This is a table within the same database specifically created and solely used by Vnext. The Vnext application will use the same database for all other requests, but add data only to the specific shadow table(s). That means that you no longer need to keep two separate databases up to date. It does mean that you might still have an extra load on your database, since both Vlatest and Vnext will use (some) of the same tables.</p><p>Again, it will depend on your application and your needs if this options might be a proper fit.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extend-data-model">Extend data model<a class="hash-link" href="#extend-data-model" title="Direct link to heading">​</a></h3><p>The last option that will be discussed is to extend your data model. You will have to create a new field to your model, for example <code>generatedBy</code> that specifies by which version of the service the record is produced. You could, for example, use <code>Vlatest</code> for your service that responds to the user input, and <code>Vnext</code> for the service that is &#x27;in&#x27; dark launch. In your code, you can then specify in your queries that you only want to use data that has a specific tag.</p><p>This option seems quite good. You have little to no extra work, and it is almost the same as a separate table. However, you should consider the cleanliness of your code and database. Since you table will contain data of all possible versions you have and your code/query has to check the version for each request. This is generally considered to be a bad practice.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h3><table><thead><tr><th>Option</th><th>Description</th><th>Pros</th><th>Cons</th></tr></thead><tbody><tr><td>Separate database</td><td>Create a separate database to be used by Vnext. Could start as a replica.</td><td>Most robust. Lowest risk of pollution</td><td>Quite complex, possibly expensive.</td></tr><tr><td>Separate table</td><td>Create a separate table to be used by Vnext. (For example TableShadow)</td><td>Quite simple, low cost.</td><td>Less robust, minor data pollution risk.</td></tr><tr><td>Extend data model</td><td>Extend the existing data model with a new field. For example: <code>generatedBy</code> that specifies what is production data, and what is not.</td><td>Cheapest solution, quite simple</td><td>Not very clean, higher risk of pollution.</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="message-queue">Message Queue<a class="hash-link" href="#message-queue" title="Direct link to heading">​</a></h2><p>A message queue receives messages from a publisher. A consumer will in turn subscribe to new messages. Depending on the implementation, the messages are or are not deleted from the queue. There are various ways to make sure that certain messages will only be received by certain consumers. The three main options are a separate queue, routing or topics/exchanges.</p><p><strong>Note:</strong> If you want a quick overview of the options and the pros and cons, <a href="#overview-1">click here</a>!</p><p><strong>Note:</strong> this guide uses the technical terms as used by RabbitMQ for queues/topics etc. This may result in different terminology than you are used to. In that case, please consult the <a href="https://www.rabbitmq.com/getstarted.html" target="_blank" rel="noopener noreferrer">documentation</a> of RabbitMQ.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="separate-queue">Separate queue<a class="hash-link" href="#separate-queue" title="Direct link to heading">​</a></h3><p>The first and probably most robust solution is to use an entirely different queue for your dark launched service. In this way you will minimize the risk of data pollution and are sure that each specific queue will only contain messages from a specific publisher. The downside of this approach, depending on you queue provider, is that this will likely double the cost in money and/or resources. Since now you have to keep two queues running all the time.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="routing">Routing<a class="hash-link" href="#routing" title="Direct link to heading">​</a></h3><p>Routing, for message queues, is a principle that let&#x27;s specific workers listen to only specific messages. For example, you can append a parameter <code>version</code> to each message on the queue whose value could be either <code>Vlatest</code> or <code>Vnext</code>. You can than make sure that the parts of your application that are not in a dark launch, will only listen for messages that contain the version <code>Vlatest</code>.
You will be able to publish all messages to the same queue, and let you consumers pick what messages they should pay attention to. In this way, you do not have to double all of you resources immediately. You will however see an increase in traffic to you queue, and possibly from your queue as well, depending on you implementation. The downside of this is that you could say that it does pollute you data. Since all messages are placed on the same queue, this queue technically does not conform to the single responsibility principle.</p><p><strong>Note:</strong> this guide uses the technical terms as used by RabbitMQ for queues/topics etc. This may result in different terminology than you are used to. In that case, please consult the <a href="https://www.rabbitmq.com/getstarted.html" target="_blank" rel="noopener noreferrer">documentation</a> of RabbitMQ.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="topics-definition-by-rabbitmq">Topics (definition by RabbitMQ)<a class="hash-link" href="#topics-definition-by-rabbitmq" title="Direct link to heading">​</a></h3><p>RabbitMQ also describes <a href="https://www.rabbitmq.com/tutorials/tutorial-two-dotnet.html" target="_blank" rel="noopener noreferrer">topics</a> in their documentation. The benefits and costs of topics is considered the same af those when routing is used.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview-1">Overview<a class="hash-link" href="#overview-1" title="Direct link to heading">​</a></h3><table><thead><tr><th>Option</th><th>Description</th><th>Pros</th><th>Cons</th></tr></thead><tbody><tr><td>Separate queue</td><td>Create a separate queue to be used by Vnext.</td><td>Most robust. No pollution. Simple</td><td>Possibly expensive.</td></tr><tr><td>Routing</td><td>Add a specific parameter to your message to specify the version of the publisher.</td><td>Cheap. Simple.</td><td>Less robust. Data pollution risk.</td></tr><tr><td>Topics</td><td>Pre- or postfix your message to differentiate the origin.</td><td>Cheap. Simple.</td><td>Less robust. Data pollution risk.</td></tr></tbody></table></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/prodtest-docs/tip-basics/dark-launch/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Dark Launch</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/prodtest-docs/category/demo-project"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Demo Project</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#database" class="table-of-contents__link toc-highlight">Database</a><ul><li><a href="#separate-database" class="table-of-contents__link toc-highlight">Separate database</a></li><li><a href="#separate-table" class="table-of-contents__link toc-highlight">Separate table</a></li><li><a href="#extend-data-model" class="table-of-contents__link toc-highlight">Extend data model</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li></ul></li><li><a href="#message-queue" class="table-of-contents__link toc-highlight">Message Queue</a><ul><li><a href="#separate-queue" class="table-of-contents__link toc-highlight">Separate queue</a></li><li><a href="#routing" class="table-of-contents__link toc-highlight">Routing</a></li><li><a href="#topics-definition-by-rabbitmq" class="table-of-contents__link toc-highlight">Topics (definition by RabbitMQ)</a></li><li><a href="#overview-1" class="table-of-contents__link toc-highlight">Overview</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/prodtest-docs/">prodtest</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/brdv/prodtest-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docs repository<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/brdv/prodtest-demo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Demo repository<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 prodtest. Built with Docusaurus.</div></div></div></footer></div>
<script src="/prodtest-docs/assets/js/runtime~main.d6632b52.js"></script>
<script src="/prodtest-docs/assets/js/main.d419b82a.js"></script>
</body>
</html>