<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tip-basics/dark-launch">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Dark Launch | prodtest</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://brdv.github.io//prodtest-docs/tip-basics/dark-launch"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Dark Launch | prodtest"><meta data-rh="true" name="description" content="This page describes a dark launch, also known as shadow release, dark mirror release or dark traffic test but at prodtest we call it a dark launch. A dark launch is a deployment or testing stategy for testing a newer version of a service or piece of software. The main goal of a dark launch is to mirror (a subset of) incoming production traffic to the new service but discarding the response. This allows you to monitor the funcitonality and performance of the service while under a real-world production load without taking the risk of exposing your users to it."><meta data-rh="true" property="og:description" content="This page describes a dark launch, also known as shadow release, dark mirror release or dark traffic test but at prodtest we call it a dark launch. A dark launch is a deployment or testing stategy for testing a newer version of a service or piece of software. The main goal of a dark launch is to mirror (a subset of) incoming production traffic to the new service but discarding the response. This allows you to monitor the funcitonality and performance of the service while under a real-world production load without taking the risk of exposing your users to it."><link data-rh="true" rel="icon" href="/prodtest-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://brdv.github.io//prodtest-docs/tip-basics/dark-launch"><link data-rh="true" rel="alternate" href="https://brdv.github.io//prodtest-docs/tip-basics/dark-launch" hreflang="en"><link data-rh="true" rel="alternate" href="https://brdv.github.io//prodtest-docs/tip-basics/dark-launch" hreflang="x-default"><link rel="stylesheet" href="/prodtest-docs/assets/css/styles.70546f8b.css">
<link rel="preload" href="/prodtest-docs/assets/js/runtime~main.36218d5e.js" as="script">
<link rel="preload" href="/prodtest-docs/assets/js/main.ebaa352d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/prodtest-docs/"><b class="navbar__title text--truncate">prodtest</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/brdv/prodtest-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prodtest-docs/">Prodtest</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/prodtest-docs/category/testing-in-production">Testing in production</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing in production&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/prodtest-docs/tip-basics/dark-launch">Dark Launch</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/prodtest-docs/category/demo-project">Demo Project</a><button aria-label="Toggle the collapsible sidebar category &#x27;Demo Project&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/prodtest-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/prodtest-docs/category/testing-in-production"><span itemprop="name">Testing in production</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Dark Launch</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Dark launch</h1><p>This page describes a dark launch, also known as shadow release, dark mirror release or dark traffic test but at prodtest we call it a dark launch. A dark launch is a deployment or testing stategy for testing a newer version of a service or piece of software. The main goal of a dark launch is to mirror (a subset of) incoming production traffic to the new service but discarding the response. This allows you to monitor the funcitonality and performance of the service while under a real-world production load without taking the risk of exposing your users to it.</p><p>This guide describes dark launches more in depth and shows various ways to implement a dark launch.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-a-dark-launch">What is a dark launch<a class="hash-link" href="#what-is-a-dark-launch" title="Direct link to heading">​</a></h2><p>As mentioned in the top section, a dark launch means that you will deploy two versions of the same service or software. Let&#x27;s call them Vcurrent (released version) and Vnext (new version). When both versions are deployed you have to mirror (a part of) the incoming requests to Vnext. Mirroring means that somehow (we&#x27;ll get to that later) you have to send requests to both Vcurrent and Vnext - the mirroring - while letting the user interact solely with Vcurrent. The traffic that is mirrored to Vnext will not result in a response to the user. The basic interaction will look like this:</p><p><img loading="lazy" alt="Dark Launch basic" src="/prodtest-docs/assets/images/dark-launch-basic-1af450db78e248670e12a0d44c81a5e4.png" width="695" height="376" class="img_ev3q"></p><p>Note that a more elaborate scheme is depicted in <a href="#how-to-dark-launch">How to dark launch</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-use-a-dark-launch">Why use a dark launch<a class="hash-link" href="#why-use-a-dark-launch" title="Direct link to heading">​</a></h2><p>Let&#x27;s say that you have upgraded an important piece of a service that has to do with an expected response time improvement. You want to test the service to see if the expected speed improvement will actually occur. Because you don&#x27;t know if the improvement is stable yet, you want to test the service without exposing it to end-users. By implementing a dark launch you can directly test your new service with actual real-world production traffic that is generated by users. Since the response from Vnext is discarded, the end-user will not know about the processing that happens in Vnext.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-dark-launch">How to dark launch<a class="hash-link" href="#how-to-dark-launch" title="Direct link to heading">​</a></h2><p>There are two main ways to do a dark launch, external and internal, both with their own use case.</p><p>The first use case is to dark launch a new (version of) a service that receives requests from outside your infrastructure (e.g. cluster). This is called an external dark launch. In this case you receive a request from an external service or client. You can copy the request at the entrypoint to your infrastructure. Usually, this entrypoint is a proxy service. The idea is that you add a rule to the proxy to - besides sending all requests to Vcur - copy a certain percentage to the Vnext instance. The proxy should then discard the responses from Vnext and only return the response from Vcur.</p><p>There are several proxies that support mirroring incoming requests, <a href="https://nginx.org/en/docs/http/ngx_http_mirror_module.html" target="_blank" rel="noopener noreferrer">NGINX</a> and <a href="https://doc.traefik.io/traefik/routing/services/#mirroring-service" target="_blank" rel="noopener noreferrer">Traefik</a> are two examples. In the demo project, an example using Traefik has been implemented. (<a href="/prodtest-docs/demo/examples/external-dl">Check it out!</a>)</p><p>The second type of dark launches is a use case where the requests originates from within your infrastructure. The request originates from a service A and goes to service B. Since this all happens within your infrastructure, this type of dark launch is called an internal dark launch. There are several ways to implement an internal dark launch. <strong><em>This use case will be explored in a later iteration.</em></strong></p><p>Which option is best suited for you, depends on your use case. Basically it depends of the architecture and the origin of the request you will use. If you want to dark launch something that recieves requests through a proxy, take advantage of that proxy. An example implementation can be <a href="/prodtest-docs/demo/examples/external-dl">found here</a>.
If your use case consists of communication withing a cluster between two services, a proxy implementation of a dark launch might not suffice. In that case, look into other options as <a href="#">described here</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="external">External<a class="hash-link" href="#external" title="Direct link to heading">​</a></h3><p>As described above, an external dark launch can benefit the use of a proxy.
A proxy - or proxyserver - is a server application that sits in between a client and a resource and that acts as an intermediary. The benefits of a proxy is that the client does not have to have a direct connection to the resource but can request a resource by the proxy. The proxy in turn passes the request to the resource and returns the response. This intermediary can allow you to make a copy of (a percentage of) all incoming requests and send that copy to a newer version of the resource. Both resources can log relevant information that in turn can be sent to a monitoring service. This would look as follows:</p><p><img loading="lazy" alt="Dark Launch proxy concept" src="/prodtest-docs/assets/images/dl-external-dab999c4d407229df39183f961bf6f24.png" width="877" height="299" class="img_ev3q"></p><p>*<!-- --> the response of Vnext will be discarded by the proxy. Only the response of Vcurrent will be sent back.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="internal">Internal<a class="hash-link" href="#internal" title="Direct link to heading">​</a></h3><p>When you want to dark launch a new service that communicates directly with another service in your cluster, you can use an internal dark launch. Internal meaning that the communication happens within your cluster.</p><p>An internal dark launch can be implemented by using a message queue (often in combination with an Event-Driven Architecture, EDA). In this case you have a service (service A), that uses another service (service B) for your application. Normally, service A publishes an event to a message queue, which will be consumed by the subscriber, i.e. service B. You want to test how a new version of service B would handle real-world production data and decide to implement a dark launch.</p><p>This would go as follows: setup your message queue to allow multiple consumers for an event. Let both service B vlatest and vnext consume those events and do their work. Eventually, both versions will return an event to the queue. The response of Vnext is flagged in some way (for example: with an origin = vnext property) telling service A to ignore this response. Below you can see a schematic view of this use case:</p><p><img loading="lazy" alt="internal dark launch simple" src="/prodtest-docs/assets/images/dl-internal-c6f0b932237264ef6544293e33c21439.png" width="786" height="299" class="img_ev3q"></p><p>As you can see, service A only consumes responses (acknowledgement) of the Vlatest service.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="risks-of-dark-launch">Risks of dark launch<a class="hash-link" href="#risks-of-dark-launch" title="Direct link to heading">​</a></h2><p>Since the goal of a dark launch is to test a new or updated service in a production environment under production load <strong>without</strong> exposing it to end users, the risks of a dark launch are relatively small. However there are a few things to keep in mind when implementing a dark launch.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-separation">Data separation<a class="hash-link" href="#data-separation" title="Direct link to heading">​</a></h3><p>Since you are testing a new feature in a production envorinment using production data (from the mirrored requests), you have to be very careful nog to save the responses from the new feature or service to the production database that <strong>is</strong> exposed to end users. How you can separate the test and production data in the production environment will be elaborated in a <strong>future iteration</strong>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-of-a-dark-launch">Example of a dark launch<a class="hash-link" href="#example-of-a-dark-launch" title="Direct link to heading">​</a></h2><p>You can find examples of a dark launch in the <a href="/prodtest-docs/category/demo-project">demo project</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/prodtest-docs/category/testing-in-production"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Testing in production</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/prodtest-docs/category/demo-project"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Demo Project</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-a-dark-launch" class="table-of-contents__link toc-highlight">What is a dark launch</a></li><li><a href="#why-use-a-dark-launch" class="table-of-contents__link toc-highlight">Why use a dark launch</a></li><li><a href="#how-to-dark-launch" class="table-of-contents__link toc-highlight">How to dark launch</a><ul><li><a href="#external" class="table-of-contents__link toc-highlight">External</a></li><li><a href="#internal" class="table-of-contents__link toc-highlight">Internal</a></li></ul></li><li><a href="#risks-of-dark-launch" class="table-of-contents__link toc-highlight">Risks of dark launch</a><ul><li><a href="#data-separation" class="table-of-contents__link toc-highlight">Data separation</a></li></ul></li><li><a href="#example-of-a-dark-launch" class="table-of-contents__link toc-highlight">Example of a dark launch</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/prodtest-docs/">prodtest</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/brdv/prodtest-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docs repository<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/brdv/prodtest-demo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Demo repository<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 prodtest. Built with Docusaurus.</div></div></div></footer></div>
<script src="/prodtest-docs/assets/js/runtime~main.36218d5e.js"></script>
<script src="/prodtest-docs/assets/js/main.ebaa352d.js"></script>
</body>
</html>