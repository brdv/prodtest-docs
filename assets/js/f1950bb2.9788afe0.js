"use strict";(self.webpackChunkprodtest=self.webpackChunkprodtest||[]).push([[23],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var i=r.createContext({}),p=function(e){var t=r.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=p(e.components);return r.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(a),h=n,m=d["".concat(i,".").concat(h)]||d[h]||u[h]||o;return a?r.createElement(m,s(s({ref:t},c),{},{components:a})):r.createElement(m,s({ref:t},c))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,s=new Array(o);s[0]=d;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:n,s[1]=l;for(var p=2;p<o;p++)s[p]=a[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},9115:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var r=a(7462),n=(a(7294),a(3905));const o={title:"README copy",sidebar_position:8},s=void 0,l={unversionedId:"demo/technical-detail/README-copy",id:"demo/technical-detail/README-copy",title:"README copy",description:"This page is an exact copy of the README.md file found in the prodtest-demo project.",source:"@site/docs/demo/technical-detail/README-copy.md",sourceDirName:"demo/technical-detail",slug:"/demo/technical-detail/README-copy",permalink:"/prodtest-docs/demo/technical-detail/README-copy",draft:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"README copy",sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Testing the project",permalink:"/prodtest-docs/demo/technical-detail/testing"},next:{title:"Examples",permalink:"/prodtest-docs/category/examples"}},i={},p=[{value:"Contents",id:"contents",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setup kubernetes cluster",id:"setup-kubernetes-cluster",level:2},{value:"Checking the demo project.",id:"checking-the-demo-project",level:2},{value:"Useful scripts",id:"useful-scripts",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}],c={toc:p};function u(e){let{components:t,...o}=e;return(0,n.kt)("wrapper",(0,r.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"This page is an exact copy of the README.md file found in the ",(0,n.kt)("a",{parentName:"strong",href:"https://github.com/brdv/prodtest-demo"},"prodtest-demo")," project.")),(0,n.kt)("h1",{id:"prodtest-demo"},"Prodtest demo"),(0,n.kt)("p",null,"This is the readme for the prodtest demo project. For more information, check the ",(0,n.kt)("a",{parentName:"p",href:"https://brdv.github.io/prodtest-docs"},"docs"),"."),(0,n.kt)("p",null,"The current project architecture is as follows:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Project Architecture",src:a(6457).Z,width:"752",height:"467"})),(0,n.kt)("h2",{id:"contents"},"Contents"),(0,n.kt)("p",null,"The contents of this Readme are:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#prerequisites"},"Prerequisites")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#setup"},"Setup")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#checking-the-demo-project"},"Checking the demo project")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#useful-scripts"},"Useful scripts")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#troubleshooting"},"Troubleshooting"))),(0,n.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,n.kt)("p",null,"In order to run the project, please make sure the following tools are installed:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://docs.docker.com/get-docker/"},"Docker")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/"},"Kubectl")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://helm.sh/docs/intro/install/"},"Helm"))),(0,n.kt)("p",null,"*"," ",(0,n.kt)("strong",{parentName:"p"},"Note:")," Please use ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/windows/wsl/install"},"WSL")," if you are on windows"),(0,n.kt)("p",null,"To check if everything is installed correctly, run the following commands:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"# for docker\ndocker --version\n# for kubectl\nkubectl version --short\n# for helm\nhelm version --short\n")),(0,n.kt)("p",null,"If it outputs a version number, the installation has succeeded."),(0,n.kt)("h2",{id:"setup-kubernetes-cluster"},"Setup kubernetes cluster"),(0,n.kt)("p",null,"Follow the guide below to setup and start the project."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Once all prerquisites are installed, make sure you have a docker kubernetes cluster running following ",(0,n.kt)("a",{parentName:"p",href:"https://docs.docker.com/desktop/kubernetes/#enable-kubernetes"},"this guide"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Next make sure the docker-desktop kubernetes context is selected for kubectl:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"# 1) get all contexts\nkubectl config get-contexts\n\n# 2) set docker-desktop context if not set already *\nkubectl config set-context docker-desktop\n")),(0,n.kt)("p",{parentName:"li"},"*"," you can see if docker-desktop is selecten in the output of command 1."))),(0,n.kt)("p",null,"TL;DR;"),(0,n.kt)("p",null,"If you want to get everything up and running quickly, you can enter the following command and skip step 3-5:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sh ./scripts/docker/build-prodtest-images.sh latest;sh ./scripts/docker/build-prodtest-images.sh vnext; sh ./scripts/kubernetes/setup-infra.sh;sh ./scripts/kubernetes/setup-darklaunch.sh\n")),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Build all docker images (locally)"),(0,n.kt)("p",{parentName:"li"},"Run the build scripts to create local docker images."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"# from the projects root folder:\nsh ./scripts/docker/build-prodtest-images.sh latest\nsh ./scripts/docker/build-prodtest-images.sh vnext\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Apply infrastructure resources:"),(0,n.kt)("p",{parentName:"li"},"Run setup-infra script"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"# from the projects root folder:\nsh ./scripts/kubernetes/setup-infra.sh\n")),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"NOTE"),": Because it takes some time for the infrastructure to be completed; the script waits 30 secs.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Apply other kubernetes resourcess"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"# from the projects root folder:\nsh ./scripts/kubernetes/setup-darklaunch.sh\n")),(0,n.kt)("p",{parentName:"li"},"This will apply all resources to the cluster. You will see all resources in the console. (Run ",(0,n.kt)("inlineCode",{parentName:"p"},"kubectl get all")," if they do not show up.)"))),(0,n.kt)("p",null,"Nice job, you've successfully set up all resources for this demo project. You can now proceed to the next section, checks."),(0,n.kt)("h2",{id:"checking-the-demo-project"},"Checking the demo project."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},'First of all you can check if the API is up and running by going to "http://localhost/api/health". You should then see a JSON object as follows:'),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "health": "ok"\n}\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"To see the Traefik (proxy) dashboard, run the following command:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl port-forward $(kubectl get pods --selector "app.kubernetes.io/name=traefik" --output=name) 9000:9000\n')),(0,n.kt)("p",{parentName:"li"},"Leave the shell open and go to http://localhost:9000/dashboard/")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"You can check the Prometheus metrics by running the following command:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl port-forward $(kubectl get pods --selector "app.kubernetes.io/name=traefik" --output=name) 9000:9100\n')),(0,n.kt)("p",{parentName:"li"},"Leave the shell open and go to http://localhost:9000/metrics/")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Next you can call the API a couple of times by using the simulate script:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sh ./scripts/simulate_api_calls.sh -n 10\n")),(0,n.kt)("p",{parentName:"li"},"*"," the ",(0,n.kt)("inlineCode",{parentName:"p"},"-n 10")," specifies the number of times to call the API (in this case, 10 times)"),(0,n.kt)("p",{parentName:"li"},"After running the script, you can check the responses of the API in ",(0,n.kt)("inlineCode",{parentName:"p"},"temp/request_output.json"),". Thereby you can check the metrics endpoint in step ",(0,n.kt)("inlineCode",{parentName:"p"},"3"),", however, currently this is a bit cryptic.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Check the database:"),(0,n.kt)("p",{parentName:"li"},"To check the database you can do two thing: open a database management tool and connect to it (you have to port-forward the pod) or directly connect to the pod and run the mysqlsh CLI."),(0,n.kt)("p",{parentName:"li"},"The default database user is ",(0,n.kt)("inlineCode",{parentName:"p"},"prodtest")," and the default password is ",(0,n.kt)("inlineCode",{parentName:"p"},"prodtest-dl"),"."),(0,n.kt)("p",{parentName:"li"},"To port-forward the pod:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl port-forward service/prodtest-db 13306:3306\n")),(0,n.kt)("p",{parentName:"li"},"Note: this binds the local port ",(0,n.kt)("inlineCode",{parentName:"p"},"13306")," to the default MySql port in the database pod. This is done to make sure no errors occur when you have a local MySql database running."),(0,n.kt)("p",{parentName:"li"},"You can now make a connection to the database from your preferred database management tool (i.e. datagrip, sequelace)."),(0,n.kt)("p",{parentName:"li"},"To interact via the MySql sh CLI enter the following:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl exec --stdin --tty prodtest-db-0 -- /bin/mysqlsh --sql -u prodtest\n")))),(0,n.kt)("h2",{id:"useful-scripts"},"Useful scripts"),(0,n.kt)("p",null,"There are a few other commands that can be helpful during testing or development."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Cleanup kubernetes and helm charts"),(0,n.kt)("p",{parentName:"li"},"If for any reason you want to clean up the configured kubernetes resources you can enter the following command in the terminal:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sh ./scripts/kubernetes/cleanup.sh\n")),(0,n.kt)("p",{parentName:"li"},"*"," ",(0,n.kt)("strong",{parentName:"p"},"Note:")," This script may take some time due to shutdown time of some pods.\nIn some cases, the cleanup script does not successfully delete all database pods. The reason why this happens is yet unknown. You can hard delete it by resetting your Docker Desktop Kubernetes cluster or deleting all docker containers prefixed with ",(0,n.kt)("inlineCode",{parentName:"p"},"k8s_"),". If this still does not work, please ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/brdv/prodtest-demo/issues/new/choose"},"open a new issue"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Simulate API requests"),(0,n.kt)("p",{parentName:"li"},"In order to simulate API requests, you can use the script ",(0,n.kt)("inlineCode",{parentName:"p"},"simulate_api_calls.sh"),". This script will by default call the api 500 times and save the responses to ",(0,n.kt)("inlineCode",{parentName:"p"},"temp/request_output.json"),".\nUse the script as follows:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sh ./scripts/simulate_api_calls.sh\n")),(0,n.kt)("p",{parentName:"li"},"*"," ",(0,n.kt)("em",{parentName:"p"},"In case of an error like 'jq command does not exist' ",(0,n.kt)("a",{parentName:"em",href:"https://stedolan.github.io/jq/download/"},"install jq")))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Check RabbitMQ dashboard"),(0,n.kt)("p",{parentName:"li"},"You can access the RabbitMQ dashboard by port forewarding its instance."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sh ./scripts/pfw-rabbitmq.sh\n")),(0,n.kt)("p",{parentName:"li"},"Now open the browser at http://localhost:15672 and log in with the credentials in your console."))),(0,n.kt)("p",null,"*"," ",(0,n.kt)("strong",{parentName:"p"},"Note:")," In some cases, the cleanup script does not successfully delete all database pods. The reason why this happens is yet unknown. You can hard delete it by resetting your Docker Desktop Kubernetes cluster or deleting all docker containers prefixed with ",(0,n.kt)("inlineCode",{parentName:"p"},"k8s_"),". If this still does not work, please ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/brdv/prodtest-demo/issues/new/choose"},"open a new issue"),"."),(0,n.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,n.kt)("p",null,"This section contains known issues and how to fix them."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"traefik-dl service external-ip \\<pending",">"),(0,n.kt)("p",{parentName:"li"},"If the api is not reachable, this probably happened because the external ip for the traefik proxy (service/traefik-dl) is pending (run ",(0,n.kt)("inlineCode",{parentName:"p"},"kubectl get service")," to check). This is most likely caused because you have something else running locally that uses port 80. To fix this issue, close all apps that use port 80 on your machine. If this still does not work, restart your machine and try again."),(0,n.kt)("p",{parentName:"li"},"If the issue persists, please open an issue and provide your ",(0,n.kt)("inlineCode",{parentName:"p"},"kubectl get service")," output."))))}u.isMDXComponent=!0},6457:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/components-overview-b0defb0e1c3b424ccd6548b788882735.png"}}]);