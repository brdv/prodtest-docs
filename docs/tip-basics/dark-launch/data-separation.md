---
title: Data Separation
---

As mentioned on the [Dark Launch page](/tip-basics/dark-launch.md) there are different ways an application cal collect and store data. For this guide, we will stick to the ways that are used in the [prodtest-demo](https://github.com/brdv/prodtest-demo) project: a database and a message queue.

## Database

When storing data in a database in your application, you want to make sure that the data generated by Vnext will not be shown to the user. Therefore, you need to find a way to separate that data from production data. There are various ways to accomplish such a thing. The following three are described in this guide: separate database, separate table and extending the data model.

**Note:** If you want a quick overview of the options and the pros and cons, [click here](#quick-overview)!

### Separate database

One of the options is to use a separate database for Vnext. Vnext will setup a connection with the separate database and store all generated data in that database. This raises the question; what should you do if your application also needs data from the production database to function?

There are two basic options here; retrieving data directly from the production database or creating and managing a copy of the database. Both options are far from perfect. As retrieving data from a database twice (once for Vnext and once for Vlatest) will double the load on that database, meaning that you also have to double your resources. The second option might seem interesting at first, but think about the fact that you now will have to keep two database up to date all the time. Because if you do not keep your Vnext database up to date with Vlatest, you will most likely get errors on reads or writes because of data missing from the database.

This does not mean, however, that this option will never be a valid choice. It will always depend on your application.

### Separate table

Another option is to use a separate 'shadow' table. This is a table within the same database specifically created and solely used by Vnext. The Vnext application will use the same database for all other requests, but add data only to the specific shadow table(s). That means that you no longer need to keep two separate databases up to date. It does mean that you might still have an extra load on your database, since both Vlatest and Vnext will use (some) of the same tables.

Again, it will depend on your application and your needs if this options might be a proper fit.

### Extend data model

The last option that will be discussed is to extend your data model. You will have to create a new field to your model, for example `generatedBy` that specifies by which version of the service the record is produced. You could, for example, use `Vlatest` for your service that responds to the user input, and `Vnext` for the service that is 'in' dark launch. In your code, you can then specify in your queries that you only want to use data that has a specific tag.

This option seems quite good. You have little to no extra work, and it is almost the same as a separate table. However, you should consider the cleanliness of your code and database. Since you table will contain data of all possible versions you have and your code/query has to check the version for each request. This is generally considered to be a bad practice.

## Overview

| Option            | Description                                                                                                                          | Pros                                   | Cons                                       |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------- | ------------------------------------------ |
| Separate database | Create a separate database to be used by Vnext. Could start as a replica.                                                            | Most robust. Lowest risk of congestion | Quite complex, possibly expensive.         |
| Separate table    | Create a separate table to be used by Vnext. (For example TableShadow)                                                               | Quite simple, low cost.                | Less robust, minor data congestion risk.   |
| Extend data model | Extend the existing data model with a new field. For example: `generatedBy` that specifies what is production data, and what is not. | Cheapest solution, quite simple        | Not very clean, higher risk of congestion. |

## Message Queue

### Options

#### Separate queue

#### Routing

#### Topics
